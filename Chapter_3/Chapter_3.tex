%Chapter 3
\chapter{Developing a simulation methodology}
\thispagestyle{empty}
\vspace{38em}
\hrulefill
\\
\enquote*{\textit{Great Design is iteration of good design.}} - Dr M. Cobanli\\
\newpage
\section{Introduction}
This chapter details the implementation methodology of simulations to optimize mining compressed air systems. The methodology discussed in this chapter will utilize insights from previous studies. Improving on shortcomings discussed in \cref{Shortcomings of previous work}.
\par 
Implementation of a simulation is divided into three steps as shown in the flow diagram, \cref{fig: Methodology}. Firstly, an investigation on the specific air network to is performed. The data acquired from this investigation is then utilized to develop and verify a simulation model. In the final step, scenarios are tested using simulations and the results are quantified and prioritised. After the process has been reviewed, a simulation  report is then produced and passed to the mine.
\begin{figure}[h]
	\centering
	\fbox{\includegraphics[trim=-0.5cm 0.8cm -0.5cm 0.5cm,width=\textwidth]{Graphs/3/Methodology/Methodology.pdf}}
	\caption{Flow diagram of the methodology for this study.}
	\label{fig: Methodology}
\end{figure}
\newpage
\section{Investigate the system}
	\subsection{Preamble}
		Developing a detailed simulation model of a compressed air network requires thorough comprehension of the inner workings of the system. This section will discuss the investigations needed to obtain the required understanding.
	\subsection{Acquire data} % 
	The first step of the system investigation is to acquire the data and understanding that will be required to model compressed air system's function. This will require access to mine resources such as data storage systems, instrumentation, and communication with relevant engineers and personnel.
	\par 
	Comprehensive and up to date layouts illustrate a compressed air network's unique set-up, scale and location of instrumentation. More detailed layouts can provide per-level air consumption breakdowns of the network, locations of refuge bays, mining cross-sections and identified inefficiencies. This is vital to understand the operation and identify what data parameters will be required for the model. 
	\par 
	A baseline period that best represents the typical operation of the mine. Additionally, availability of data should be considered. The length of the baseline period is selected based on the scenarios that are to be tested, this can be changed later. For calibrating a compressed air system a 24 hours period of normal operation is usually sufficient. A longer period may be needed to verify the model.
	Next data 
	\subsection{Investigate mining schedules}
	A critical aspect to developing an accurate model of a mining compressed air system is apprehension of the operational philosophy of the mine. The schedule for operations such as drilling,  blasting or cleaning can have a major impact on compressed air requirements at different times of the day. By utilizing the operational schedule, simulation scenarios can be optimized for the air requirements throughout the day.	
	
	\subsection{Verify data accuracy}
	Data verification is the process where data is evaluated to ensure accuracy. It is important to verify data that is used for model development as an accurate representation of the operation of a system can only be achieved utilising data of high quality \cite{gous2016data}. The factors that influence a data-set's quality, accuracy and integrity  summarised as follows:
	\begin{itemize}
		\item Conversion of measurement value \cite{meijsen2015verification}
		\item Storage and collection of the system \cite{vanNiekerk2016quantification},\cite{Jansevan2016structuring}
		\item Traceability of measurement sources \cite{Jansevan2016structuring}
		\item Measurement equipment accuracy and malfunctions \cite{gous2016data}
		\item Data abnormalities \cite{gous2016data}
	\end{itemize} 
	\par 
	Therefore a data verification methodology is utilised to ensure datasets are of high quality. 
	\subsection{Resolve unavailable data}
		Parameters that are required to develop the simulation model, such as flows, pressures, may not be actively logged by mine systems. To obtain this data it is necessary to investigate alternative sources. At points where instrumentation is absent, estimations can be made from assumptions made using instrumentation on the network or spot inspections.
		\par 
		Air network specifications such as piping sizes, technical layouts, major leak locations or specifications is often outdated or not recorded. Critical data should be obtained through audits and inspections of the system. If manual inspection is not possible, estimations should be made using the available data or approximation techniques discussed in literature. %\texttt{REMEMBER TO REFERENCE\\ SPECIFIC LOCATION LITERATURE}.
	
	\subsection{Summary}
\newpage	
\section{Develop and verify a simulation model}
	\subsection{Preamble}
	Compressed air networks are comprised of components such as compressors, valves, pipes, etc. This section will discuss the development, calibration and verification of component models that make up a compressed air simulation. 
	
	\subsection{Select the system boundaries and simulation parameters}
	The simulation boundaries determine the detail that the system is modelled. For a simple compressed air model, the boundaries can be set around the compressor house. This model would then only include the compressor components, inlet and outlet airflows. Alternatively a more complex model can be developed by choosing boundaries to include more aspects of the system such as mining levels, processing plants etc.
	
	 \begin{figure}[h]
	 	\centering
	 	\fbox{\includegraphics[width=\textwidth]{Images/3/Sensitivity2.pdf}}
	 	\caption{ Model boundary selection examples.}
	 	\label{fig: Sensitivity}
	 \end{figure}
 
	\par 
	The boundaries should be chosen based on the input data available, required accuracy n and available time and resources. A more detailed model will lead to more accurate simulation, however it may take more time and resources to obtain the data required. Figure \cref{fig: Sensitivity} shows an example of different boundary selection for the same system.
	\par
	The period and step size selected for the simulation is just as important. The period of the simulation should be determined to ensure a scenario is fully tested. Most commonly, a 24 hour period is chosen as daily parameters are normally very similar. The simulation step size should be selected with the resolution of the available data in mind. Smaller step size selection can lead to a more accurate simulation model. 
	\subsection{Model compressed air network component}
		\subsubsection{Air pipes}
		Pressure losses occur over compressed air networks due to friction in the pipe, these losses should be taken into account in the simulation for large piping sections. A pipe model is used to account for these losses which are defined by the \textit{Darcy-Weisbach equation}\footnote{ B. Glenn, \enquote*{The Darcyâ€“Weisbach Equation,}[Online] \url{https://bae.okstate.edu/faculty-sites/Darcy/DarcyWeisbach/Darcy-WeisbachEq.htm}, [Accessed 20-05-2017]}:
		$$\Delta P = \frac{f  L \rho V^2}{2 D}$$
		Where the pressure difference $\Delta P $ is a function of:\\
		\begin{table}[h]
			\centering
			\begin{tabular}{ll}
				\hline
				Parameter & Definition\\
				\hline
				$f$ & Friction coefficient  \\
				$L$ & Pipe length ($m$) \\
				$D$ & Pipe diameter ($m$) \\
				$\rho$ & Air density ($kg/m^3$)\\	
				$V$ & Average velocity ($m/s$) \\	
				\hline
			\end{tabular} 
		\caption{Air pipe component model parameters.}
		\label{table: Darcy-Weisbach}
		\end{table}
		
		The pipe component can be used as a valve by controlling the open fraction between 0 and 1. Modelling the valve flow characteristics is discussed in \cref{Controllers} \textit{Controllers}.
		\subsubsection{Ambient conditions}
		Ambient air condition underground and on surface change the characteristics of the air, effecting the operation of the system. \cref{fig: Ambient} shows the average summer air conditions. If no data is available for the specific simulation period, the conditions can be estimated by scaling this profile. 
		\begin{figure}[h]
			\centering
			\fbox{\input{Graphs/3/Ambient/Ambient}}
			\caption{Average summer ambient air conditions at a South African gold mine.}
			\label{fig: Ambient}
		\end{figure}
		The assumption is made that underground conditions remain constant at each mining level. Pressure and temperature increases with depth as a result of auto compression and rock face temperature. Therefore the conditions can be estimated using only the depth at each level.   
		\subsubsection{Compressors}
		Three compressor models were investigated, each with varying complexity. The models are:
		\begin{itemize}
			\item Air compressor
			\item Dynamic compressor 
			\item Positive displacement compressor
		\end{itemize}  
		The air compressor is a general, simplified model. It requires minimal user inputs by making several assumptions. This is useful when parameters for a compressor are not available. Or when doing a quick preliminary simulation. However, it is not ideal for detailed simulations which require more precision. 
		\par 
		The dynamic compressor components are is more complex, taking into account factors such as heat generated by \gls{polyCof} and inefficiencies within the process. Hence, the model can be used more accurately and for more complex simulations than the general compressor model. However, it should be noted that the dynamic compressor is simplified by several assumptions, for example, a constant efficiency at varying loads. 
		\par 	 
		For most scenarios, the dynamic compressor model is most suitable. This component is modelled by fitting a quadratic curve through three points of operation to obtain an equation for corrected mass flow as a function of the pressure ratio. This characteristic curve of compressor  as shown in \cref{fig: Compressor Curve} can be accurately estimated even when only one data point is available by making approximations for the zero flow and pressure points on the curve. Once the flow characteristics of the compressors are set, the efficiency and \gls{polyCof} parameters are calibrated such that the output power and air temperature match the actual or estimated outputs of the compressor.
		
		\begin{figure}[h]
			\centering
			\fbox{\input{Graphs/3/AproxCurve/AproxCurve}}
			\caption{Estimating the characteristic curve of a compressor by fitting a quadratic function to points of operation.}
			\label{fig: Compressor Curve}
		\end{figure}

		\par
		Once the models are accurately calibrated, the compressor component is integrated to the air network in the arrangement shown in \cref{fig: Compressor models}. The Compressor is connected to the inlet air source via an inlet pipe and air node and to the rest of the network via an air node and outlet pipe. This is is to allow the inlet and outlet parameters and conditions to be be monitored and controlled.
		\begin{figure}[h]
			\centering
			\fbox{\includegraphics[trim =-4cm 0 -4cm 0cm, width=\textwidth]{Images/3/Compressors}}
			\caption{Integrating the compressor component into the simulation.}
			\label{fig: Compressor models}
		\end{figure}		

		\subsubsection{Demand/leak}
			A flow demand represents any air flow leaving the network. This includes equipment that uses air such as drills and agitators etc. as well as inefficiencies like leaks and open pipes. Generally the air flow is dependent on pressure and the specific resistance to flow of the outlet. 
			\par 
			The resistance of the flow demand can be obtained using the inlet pressure, outlet pressure and flow. If the flow is not known, a reasonably accurate estimation can be made by calculating the expected flow from the size of the outlet. The air demand may vary throughout the day. For example, a mining section may utilise more machines during certain periods of the day. A schedule is used to replicate this in the simulation. \cref{fig: Demand component} shows how a calibrated air demand or leak is integrated into the simulation.
			
			\begin{figure}[h]
				\centering
				\fbox{\includegraphics[trim =-12cm 0.5cm -12cm 0.5cmcm, width=\textwidth]{Images/3/AirDemand}}
				\caption{Implementing flow demands and leaks into the simulation.} 
				\label{fig: Demand component}
			\end{figure}
		\subsubsection{Compressed air control}\label{Controllers}
			Simulation components need to be dynamically controlled as in the actual air network. Control is typically implemented on compressors and valves throughout the network to follow certain set-points and schedules. It is important to not only include the controllers in the simulation, but to replicate the non-linearities, limitations and responsiveness related to their use. This ensures the model reacts in the same way the actual network would, improving accuracy.
			\par 
			On a typical mine, compressors power is controlled to ensure that the discharge pressure matches a specified set-point. This control is achieved through either \glspl{vsd} (or \glspl{vfd}) and guide-vain control. \glspl{vfd} provides a wide range of power control and can be estimated using a \gls{pi} controller as in \cref{fig: Controller models} where discharge pressure is used as feedback for the controller. 
	\begin{figure}[h]
		\centering
		\fbox{\includegraphics[trim =-4cm 0 -4cm 0cm, width=\textwidth]{Images/3/Controller}}
		\caption{Control components in \gls{ptb}.}
		\label{fig: Controller models}
	\end{figure}
		Guide vains are most commonly used in mining to control compressors. This entails controlling the position of the inlet guide vain . The guide vain is opened or closed to control the compressors discharge pressure.  Manipulating the guide vain position will affect the power the compressor inputs into the system. \cref{fig: Guide vain position} shows the relationship between  power and guide vain position. This can be modelled as a linear function where a guide vain position of 40\% relates to an output power of about 60\% of the maximum power. When more pressure is required than can be obtained with the guide vains fully opened, another compressor is needed to operate. 
		\begin{figure}[h]
			\centering
			\fbox{\input{Graphs/1/GuideVainPosition/GuideVainPosition}}
			\caption{Modeling the compressor control from a guide vain}
			\label{fig: Guide vain position}
		\end{figure}
		\par
		A guide vain controller is modelled using a \gls{pi} controller component. However, the limitations of guide vain control, as represented in \cref{fig: Guide vain position}, must be implemented in the controller. This is done by using a minimum output that would match the minimum power reduction the guide vain achieved by closing the guide vain. For example, a \gls{pi} controller for the compressor from \cref{fig: Guide vain position} would have a minimum control output of approximately 60\%.
		\par 
		Mines utilize control valves at underground sections to control the pressure at individual mining stations independently \cite{Heyns2014Masters}. Controlling of valve components is performed similarly as control of the compressor components. As shown in \cref{fig: Controller models} the outlet pressure is used as feedback for a pi controller. The controller output is mapped to the valve fraction of a pipe component.
		\begin{figure}[h]
			\centering
			\fbox{\includegraphics[trim =-2cm 0 -2cm 0cm, width=\textwidth]{Images/3/Valve.jpg}}
			\caption[An example of a compressed air control valve.]{An example of a compressed air control valve\cite{van2015implementation}.} 
			\label{fig: Control}
		\end{figure}
		\subsubsection{Compressed air after-cooling}
		The air compression process generates significant heat. Compressed air at high temperatures contains a large amount of water vapour. To prevent condensation later in the air network, improve the system capacity and protect equipment from excessive heat, after-coolers are installed to the outlet of the compressor \cite{schroeder2009energy}.
		\par 
		After-cooling reduces the compressed air temperature out of the compressors. This cooling can have an effect on the operation of the network. Hence, including after-cooling to the simulation model should improve accuracy. 
		To replicate this effect, a heat transfer node can be added to the outlet of the compressor component. The heat transfer parameters shown in \cref{table: After cooling inputs} should be calibrated such that the air temperature matches after-cooled air temperature measurements. An assumption of 40 $^\circ$\gls{c} can be used if no measurements are available.
		\par
		\begin{table}
			\centering
			\begin{tabular}{lll}
				\hline 
				Parameter \hspace{1cm} & Definition \hspace{4cm} & Unit \\
				\hline
				$A$ & The heat transfer area & $m^2$ \\
				$UA$ & Heat transfer coefficient & $kW/^{\circ} C$ \\
				$T_{amb}$ & Ambient air temperature & $^{\circ} C$ \\
				\hline
			\end{tabular}
		\caption{The input parameters for the after-cooling simulation model .}
		\label{table: After cooling inputs}
		\end{table}
	Depending on the accuracy requirement, after-cooling can be excluded from the simulation. Post after-cooling, compressed air is normally still warmer then ambient conditions. Air temperatures underground can be accurately matched by including heat transfer for compressed air pipelines.
	\subsection{Verify simulation model}
		- Steps to validate  the model accuracy - Compare parameters to actuals\\
		- First principles     - Comparison to other models
		
	\subsection{Select simulation inputs}
		The inputs of a simulation are any parameters that do not remain static, or follow the same profile in day to day operation of the system. Examples of such parameters in a compressed air simulation are:
		\begin{itemize}
			\item Surface ambient conditions
			\item Machine operation schedules
			\item Air demands
			\item Operational changes
		\end{itemize} 
		Changing the simulation baseline period for a calibrated simulation should only require the updating of the input parameters. \cref{fig: Compressor schedule} shows an example of a changing compressor schedule where an input parameter would need to be updated in the simulation.
		\begin{figure}[h]
			\centering
			\fbox{\input{Graphs/3/CompSelection/CompSelection}}
			\caption{An example of two baseline periods, showing a changed compressor schedule.}
			\label{fig: Compressor schedule}
		\end{figure}
	
	\subsection{Periodic simulation}	
		Period simulation refers to the repetition of simulations over subsequent periods to determine the sequential accuracy of the model.  This is important to verify the model is valid in general and not just a single period.  This simulation will also indicate where operation changes have occurred as the simulation accuracy will be reduced.
		\par 
		The following process is followed to implement periodic simulation: Simulation input data is collected periodically for each simulation interval, this data includes only inputs that vary day to day such as schedules, air conditions and  measured flows. Once the input values are collected, they are then imported into the compressed air model. The simulation performed and the output data is exported for analysis. The  simulated data is then compared with the actual operation of the system and major discrepancies are identified. This process is triggered periodically.
		\begin{figure}[h]
			\centering
			\fbox{\includegraphics[trim =0cm 0.5cm 0cm 1cm,width=\textwidth]{Graphs/4/PeriodicProcess/PeriodicProcess.pdf}}
			\caption{The periodic simulation process that was followed in this analysis.}
			\label{fig: PeriodicProcess}
		\end{figure}
	
	\subsection{Summary}
	\textit{Unfinished}
\newpage
\section{Implementation of simulation method}
	\subsection{Preamble}
		Once a simulation has been developed and verified, the implementation of interventions and scenarios follows. In this section, the approach of implementation the simulation methodology, and analysis of interventions will be discussed.
	\subsection{Analyse data}
		- Baseline vs Optimised analysis \\
		- identification of further improvements\\
		\textit{Unfinished}
	
	\subsection{Quantify operational improvements}
		- Estimating cost savings \\
		- Reporting feedback to the mine\\
		\textit{Unfinished}
	\subsection{Summary}
\section{Conclusion}
