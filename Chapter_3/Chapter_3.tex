%Chapter 3
\chapter{Developing a simulation methodology}
\thispagestyle{empty}
\vspace{38em}
\hrulefill
\\
\enquote*{\textit{Quote.}} - Somebody\\
\newpage
\section{Introduction}
This chapter details the implementation methodology of simulations to optimize mining compressed air systems. The methodology discussed in this chapter will utilize insights from previous studies. Improving on shortcomings discussed in section \ref{Shortcomings of previous work}.
\par 
Implementation of a simulation is split into three steps. Firstly, an investigation on the specific air network to is performed. The data acquired from this investigation is then utilized to develop and verify a simulation model. Finally scenarios are implemented using the simulations and the results are quantified and ranked. A simulation  report is then produced and passed to the mine.
\section{System investigation method}
	\subsection{Preamble}
		Developing a detailed simulation model of a compressed air network requires thorough comprehension of the inner workings of the system. This section will discuss the investigations needed to obtain the required understanding.
	\subsection{Acquiring data} % 
	The first step of the system investigation is to acquire the data and understanding that will be required to model compressed air system's function. This will requires access to mine resources such as data storage systems, instrumentation, and communication with relevant engineers and personnel.
	\par 
	Comprehensive and up to date layouts illustrate a compressed air network's unique set-up, scale and location of instrumentation. More detailed layouts can provide per-level air consumption breakdowns of the network, locations of refuge bays, mining cross-sections and identified inefficiencies. This is vital to understand the operation and identify what data parameters will be required for the model. 
	\par 
	
	\subsection{Mining schedule}
	A critical aspect to developing an accurate model of a mining compressed air system is understanding the the operational philosophy of the mine. The schedule for operations such as drilling,  blasting or cleaning can have a major impact on compressed air requirements at different times of the day. By utilizing the operational schedule, simulation scenarios can be optimized for the air requirements throughout the day.	
	\subsection{Data accuracy and verification}
	
	\subsection{Solutions to unavailable data}
		Parameters that are required to develop the simulation model, such as flows, pressures, may not be actively logged by mine systems. To obtain this data it is necessary to investigate alternative sources. At points where instrumentation is absent, estimations can be made from assumptions made using instrumentation on the network or spot inspections.
		\par 
		Air network specifications such as piping sizes, technical layouts, major leak locations or specifications is often outdated or not recorded. Critical data should be obtained through audits and inspections of the system. If manual inspection is not possible, estimations should be made using the available data or approximation techniques discussed in literature. %\texttt{REMEMBER TO REFERENCE\\ SPECIFIC LOCATION LITERATURE}.
	
	\subsection{Summary}
		
\section{Model development and verification}
	\subsection{Preamble}
	Compressed air networks are comprised of components such as compressors, valves, pipes, etc. This section will discus the development, calibration and verification of component models that make up a compressed air simulation is. 
	\subsection{Compressed air component models}
		\subsubsection{Air pipes}
		Pressure losses occur over compressed air networks due to friction in the pipe, these losses should be taken into account in the simulation for large piping sections. A pipe model is used to account for these losses which are defined by the \textit{Darcy-Weisbach equation}\footnote{ B. Glenn, \enquote*{The Darcyâ€“Weisbach Equation,}[Online] \url{https://bae.okstate.edu/faculty-sites/Darcy/DarcyWeisbach/Darcy-WeisbachEq.htm}, [Accessed 20-05-2017]}:
		$$\Delta P = \frac{f  L \rho V^2}{2 D}$$
		Where the pressure difference $\Delta P $ is a function of:\\
		\begin{tabular}{p{1.3cm}p{13cm}}
		$f$ & Friction coefficient  \\
		$L$ & Pipe length ($m$) \\
		$D$ & Pipe diameter ($m$) \\
		$\rho$ & Air density ($kg/m^3$)\\	
		$V$ & Average velocity ($m/s$) \\
		\end{tabular} \\
		The pipe component can be used as a valve by controlling the open fraction between 0 and 1. Modelling the valve flow characteristics is discussed in \ref{Controllers} \textit{Controllers}.
		\subsubsection{Ambient conditions}
		Ambient air condition underground and on surface change the characteristics of the air, effecting the operation of the system. Figure \ref{fig: Ambient} shows the average summer air conditions. If no data is available for the specific simulation period, the conditions can be estimated by scaling this profile. 
		\begin{figure}[h]
			\centering
			\fbox{\input{Graphs/3/Ambient/Ambient}}
			\caption{Average summer ambient air conditions at a South African gold mine.}
			\label{fig: Ambient}
		\end{figure}
		The assumption is made that underground conditions remain constant at each mining level. Pressure and temperature increases with depth as a result of auto compression and rock face temperature. Therefore the conditions can be estimated using only the depth at each level.   
		\subsubsection{Compressors}
		Three compressor models were investigated, each with varying complexity. The models are: air compressor, dynamic compressor and positive displacement compressor. The air compressor is a general, simplified model. It requires minimal user inputs by making several assumptions. This is useful when parameters for a compressor are not available. Or when doing a quick preliminary simulation. However it is not ideal for detailed simulations which require more precision. 
		\par 
		The dynamic compressor components are is more complex, taking into account factors such as heat generated by \gls{polyCof} and inefficiencies within the process. Hence the model can be used more accurately and for more complex simulations then the general compressor model. However, it should be noted that the dynamic compressor is simplified by several assumptions, for example, a constant efficiency at varying loads. 
		\par 	 
		For most scenarios, the dynamic compressor model is most suitable. This component is modelled by fitting a quadratic curve through three points of operation to obtain an equation for corrected mass flow as a function of the pressure ratio. This characteristic curve of compressor  as shown in figure \ref{fig: Compressor Curve} can be accurately estimated even when only one data point is available by making approximations for the zero flow and pressure points on the curve. Once the flow characteristics of the compressors are set, the efficiency and \gls{polyCof} parameters are calibrated such that the output power and air temperature match the actual or estimated outputs of the compressor.
		
		\begin{figure}[h]
			\centering
			\fbox{\input{Graphs/3/AproxCurve/AproxCurve}}
			\caption{Estimating the characteristic curve of a compressor by fitting a quadratic function to points of operation.}
			\label{fig: Compressor Curve}
		\end{figure}

		\par
		Once the models are accurately calibrated, the compressor component is integrated to the air network in the arrangement shown in figure \ref{fig: Compressor models}. The Compressor is connected to the inlet air source via an inlet pipe and air node and to the rest of the network via an air node and outlet pipe. This is is to allow the inlet and outlet parameters and conditions to be be monitored and controlled.
		\begin{figure}[h]
			\centering
			\fbox{\includegraphics[trim =-4cm 0 -4cm 0cm, width=\textwidth]{Images/3/Compressors}}
			\caption{Integrating the compressor component into the simulation.}
			\label{fig: Compressor models}
		\end{figure}		

		\subsubsection{Demand/leak}
			A flow demand represents any air flow leaving the network. This includes equipment that uses air such as drills and agitators etc. as well as inefficiencies like leaks and open pipes. Generally the air flow is dependent on pressure and the specific resistance to flow of the outlet. 
			\par 
			The specific resistance of the flow demand can be obtained using the inlet pressure, outlet pressure and flow. If the flow is not known, a reasonably accurate estimation can be made by calculating the expected flow from the size of the outlet. The air demand may vary throughout the day. For example, a mining section may utilise more machines during certain periods of the day. A schedule is used to replicate this in the simulation. Figure \ref{fig: Demand component} shows how a calibrated air demand or leak is integrated into the simulation.
			
			\begin{figure}[h]
				\centering
				\fbox{\includegraphics[trim =-12cm 0.5cm -12cm 0.5cmcm, width=\textwidth]{Images/3/AirDemand}}
				\caption{Implementing flow demands and leaks into the simulation.} 
				\label{fig: Demand component}
			\end{figure}
		\subsubsection{Compressed air control}\label{Controllers}
			Simulation components need to be dynamically controlled as in the actual air network. Control is typically implemented on compressors and valves throughout the network to follow certain set-points and schedules. It is important to not only include the controllers in the simulation, but to replicate the non-linearities, limitations and responsiveness related to their use. This ensures the model reacts in the same way the actual network would, improving accuracy.
			\par 
			On a typical mine, compressors power is controlled to ensure that the discharge pressure matches a specified set-point. This control is achieved through either \glspl{vsd} (or \glspl{vfd}) and guide-vain control. \glspl{vfd} gives a wide range of power control and can be estimated using a \gls{pi} controller as in figure \ref{fig: Controller models} where discharge pressure is used as feedback for the controller. 
	\begin{figure}[h]
		\centering
		\fbox{\includegraphics[trim =-4cm 0 -4cm 0cm, width=\textwidth]{Images/3/Controller}}
		\caption{Control components in \gls{stb}.}
		\label{fig: Controller models}
	\end{figure}
	\par 
		Guide vain control is most commonly used in mining to control compressors. This entails controlling the position of the inlet guide vain . The guide vain is opened or closed to control the compressors discharge pressure.  Manipulating the guide vain position will effect the power the compressor inputs into the system. Figure \ref{fig: Guide vain position} shows the relationship between compressor power and guide vain position. This relationship can be approximated as a linear function. A guide vain position of 40\%  maps to an output power of about 60\% of the maximum power. When more pressure is required than can be obtained with the guide vains fully opened, another compressor is needed to operate. 
		\begin{figure}[h]
			\centering
			\fbox{\input{Graphs/1/GuideVainPosition/GuideVainPosition}}
			\caption[The relation between guide vain position and compressor output power.]{The relation between guide vain position and compressor output power.}
			\label{fig: Guide vain position}
		\end{figure}
		\par
		A guide vain controller is modeled using a \gls{pi} controller component. However the limitations of guide vain control, as represented in figure \ref{fig: Guide vain position}, must be implemented in the controller. This is done by using a minimum output that would match the minimum power reduction the guide vain achieved by closing the guide vain. For example, a \gls{pi} controller for the compressor from figure \ref{fig: Guide vain position} would have a minimum control output of approximately 60\%.
		\par 
		Mines utilise control valves underground sections to control the pressure at individual mining stations independently \cite{Heyns2014Masters}. Controlling of valve components is perfomed similarly as control of the compressor components. As shown in figure \ref{fig: Controller models} the outlet pressure is used as feedback for a pi controller. The controller output is mapped to the valve fraction of a pipe component.
		\begin{figure}[h]
			\centering
			\fbox{\includegraphics[trim =-2cm 0 -2cm 0cm, width=\textwidth]{Images/3/Valve.jpg}}
			\caption[An example of a compressed air control valve.]{An example of a compressed air control valve\cite{van2015implementation}.} 
			\label{fig: Control}
		\end{figure}
		\subsubsection{Compressed air after-cooling}
		The air compression process generates significant heat. Compressed air at high temperatures contains a large amount of water vapour. To prevent condensation later in the air network, improve the system capacity and protect equipment from excessive heat, after-coolers are installed to the outlet of the compressor \cite{schroeder2009energy}.
		\par 
		After-cooling reduces the compressed air temperature to within a margin of ambient. This cooling could have a large effect on the performance of the network. Hence including after-cooling to the simulation model should improve accuracy.
		\par 
		To replicate this effect, a heat transfer node can be added to the outlet of the compressor component. \gls{stb} utilizes the following heat transfer parameters of the air node to solve for outlet temperature:
		\par 
		\begin{tabular}{p{1.3cm}p{13cm}}
			$Area$ & The heat transfer area ($m^2$) \\
			$UA$ & Heat transfer coefficient ($kW/^{\circ} C$) \\
			$T_{amb}$ & Ambient air temperature ($^{\circ} C$) \\
		\end{tabular} \\	
	

	\subsection{Verification of simulation model}
		- Steps to validate  the model accuracy .\\
		- Compare parameters to actuals\\
		- First principles\\
		-
		
	\subsection{Simulation inputs}
		The inputs of a simulation are any parameters that do not remain static, or follow the same profile in day to day operation of the system. Examples of such parameters in a compressed air simulation are:
		\begin{itemize}
			\item Simulation period
			\item Surface ambient conditions
			\item Compressor selection and schedules
			\item Flow demands
			\item Operational changes
		\end{itemize} 
		Changing the simulation baseline period for a calibrated simulation should only require the updating of the input parameters. Figured ??? shows an example of a changing compressor schedule where an input parameter would need to be updated in the simulation.
	\subsection{Summary}
\section{Implementation of simulation method}
	\subsection{Preamble}
		Once a simulation has been developed and verified, the implementation of interventions and scenarios follows. In this section, the approach of implementation, and analysis of interventions in simulation will be discussed.
	\subsection{Analyses of data}
		- Baseline vs Optimised comparison \\
	\subsection{Quantifying operational improvements}
		- Estimating cost savings
	\subsection{Summary}
\section{Conclusion}
